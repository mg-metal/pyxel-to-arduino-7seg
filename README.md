# Pyxel-Arduino 7セグLEDアニメーションエディタ

このプロジェクトは、レトロゲームエンジン **Pyxel** を使用してPC上に7セグメントLEDのアニメーションエディタを構築し、**シリアル通信**を通じて **Arduino** が制御する実機の7セグLEDにそのパターンを反映させるためのツールです。

---

## 2. コンセプト

シンプルなハードウェアを、手軽なソフトウェア（Pyxel）で拡張することを目指しました。

特徴：Pyxel側でマウス操作によりアニメーションパターンを編集し、リアルタイムで実機に転送・表示します。通信の安定化のために**ハンドシェイク（フロー制御）**を実装しています。

---

## 3. 環境構築と使用方法

### 3.1 必要なもの（Required）

| 分類 | 項目 | 備考 |
| :--- | :--- | :--- |
| **ハードウェア** | Arduino UNO R3（または互換ボード） | |
| | 7セグメントLED（1桁×2個） | **カソードコモン**を前提とします |
| | その他 | **抵抗器（1kΩ推奨）**、ジャンパワイヤ、ブレッドボードなど |
| **ソフトウェア** | Python 3.x | |
| | Pyxel | `pip install pyxel` |
| | PySerial | `pip install pyserial` |
| | Arduino IDE | |

### 3.2 ハードウェアの準備（Hardware Setup）

1.  7セグLEDのセグメント端子(a～dp)をArduinoのデジタルピンD2〜D9に接続します。
    * **抵抗器を介して接続**してください。（光を弱める目的で1kΩを使用しました）
2.  コモン端子をD10(右LED)とD11(左LED)に接続します。

* **前提:** 本コードは**カソードコモン**のダイナミック点灯を前提としています。
    * **カソード/アノード間違い**にご注意ください。（私は注意しなかったため間違えちゃいましたが）

### 3.3 Arduinoへの書き込み（Arduino Sketch）

1.  Arduino IDEで **`SevenSegLed.ino`** を開き、使用しているArduinoボードに書き込みます。

### 3.4 Pyxelエディタの実行（Pyxel Editor）

1.  Python環境で **`pyxel_Arduino.py`** を実行します。
2.  **接続設定の変更:**
    * コードの冒頭にあるシリアル接続設定（`pyxel_Arduino.py`）の `"COM3"` 部分を、ご使用の環境のArduinoのCOMポート番号に合わせて変更してください。

```python:pyxel_Arduino.py (抜粋)
ser = serial.Serial("COM3", 115200, timeout=0.1)
```
---
## 4. 使用上の注意とトラブルシューティング

### 4.1 COMポートの占有について

* **【重要】** Pyxelを起動したままArduino IDEでスケッチを書き換えようとするとエラーになります。必ず**Pyxelを終了**してからArduino IDEを使用してください。
* Arduino IDEのシリアルモニタなど、他のプログラムがCOMポートを使用している状態では、Pyxelエディタは接続できません。

### 4.2 Pyxel側のエディタ操作について

#### 編集操作
* **LEDセグメント点灯パターン編集**
    * ON: マウス左ボタン
    * OFF: **Shiftキーを押しながら**マウス左ボタン
* **アニメパターンのセーブ/ロード**
    * セーブ: `S` キー
    * ロード: `L` キー
    * **注意:** ファイル一つしか対応していないため、お気に入りのパターンができたら上書きされないようファイル名の変更などを行ってください。
* **Arduinoへのデータ転送**
    * `Space` キー

#### テキストボックス（パターン情報）
7セグLEDの絵の右側にあるテキストボックスは、クリックすると値がクリアされ、数値入力モードに切り替わります。

* **上：duration**
    * そのパターンを表示する時間（msec）
* **下：flicker_delay**
    * そのパターンを表示する時の**チラつき周期**の遅延時間（msec）
    * チラつきが肉眼で確認できるのは 20msec以降が目安です。
* **【お願い】** 現在、数値入力のバリデーションは実装していません。**必ず整数を入力**してください。

## 5. 課題（外部公開における制限事項）

本ツールは「作者自身の学習用・投稿用」として割り切って作成されたため、外部に公開し、広く使ってもらうためのツールとするには、いくつかの**制限事項や課題**があります。

* **Pyxel側アプリ起動にArduino接続が必須の状態:**
    * エディタ単体の動作確認ができない状況です。
* **TextBoxの使い勝手:**
    * テキストボックスは簡易的な自作実装のため、カーソル機能が無い等、編集機能が不十分です。
* **アニメパターン数:**
    * アニメパターン数が、 Arduino側では `ANIME_CAPACITY` (300) という最大数を設定しつつ、Pyxel側では更に絞って24にしてます。なんにせよ **固定長** です。コードを少しいじれば変更可能です。アプリ画面でのパターン数変更には対応してません
* **パターンの保存先:**
    * アニメパターンの保存先が1ファイル（`pattern_list.txt`）のみです。お気に入りのパターンを管理するためには、ファイル選択ダイアログや複数のスロットへの保存機能が必要です。
* **Seg7LEDクラスが未整備**
    * 描画サイズ変更に対応させるためにあれこれ試した結果がコードに残ったままです。リニアに大きさ変更するイメージはついてますが、時間足らずのため放置です。。


## 6. 採用技術とライセンス

* **言語:** Python, Arduino C/C++
* **フレームワーク:** Pyxel, PySerial

### ライセンス (License)

本プロジェクトは **MIT License** の下で公開されています。

利用、複製、改変、再頒布は自由に行えますが、著作権表示および本許諾表示をすべての複製物または重要な部分に含める必要があります。作者は、本ソフトウェアの使用またはその他の扱いによって生じる一切の請求、損害、その他の義務について責任を負いません。

詳細については、リポジトリ内の `LICENSE` ファイルをご確認ください。


---
### 📢 詳細な開発ログと技術的考察（Qiita記事）

本プロジェクトの開発経緯や、通信フリーズ、Pythonの罠をAIと共に乗り越えた詳細な記録は、以下のQiita記事で公開しています。

**記事タイトル:** 【Pyxel × Arduino】「7セグLED」ガジェットを作る 〜通信バグとPythonの罠をAIと乗り越えた開発記録〜

**Qiitaリンク:** [URL貼り付け予定]
